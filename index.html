<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS | Professional Asset Transmutation</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-app: #08090c; --bg-card: #11141b; --accent: #00fff2;
            --accent-glow: rgba(0, 255, 242, 0.25); --text-main: #ffffff;
            --text-muted: #8b92a5; --border: #222632;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--bg-app);
            background-image: radial-gradient(circle at 50% -20%, #1e2235 0%, var(--bg-app) 80%);
            color: var(--text-main); margin: 0; padding: 0; line-height: 1.6; min-height: 100vh;
        }
        .container { width: 100%; max-width: 1100px; margin: 0 auto; padding: 60px 24px; }
        header { text-align: center; margin-bottom: 40px; }
        .protocol-label { font-weight: 800; letter-spacing: 3px; color: var(--accent); text-transform: uppercase; font-size: 0.8rem; margin-bottom: 16px; display: block; }
        h1 { font-size: 3rem; font-weight: 800; margin: 0; letter-spacing: -2px; line-height: 1.1; }
        h1 span { color: var(--accent); text-shadow: 0 0 20px var(--accent-glow); }
        
        .transformer-card {
            background: var(--bg-card); border-radius: 32px; border: 1px solid var(--border);
            padding: 40px; box-shadow: 0 40px 100px -20px rgba(0,0,0,0.7);
            max-width: 700px; margin: 0 auto 60px; display: flex; flex-direction: column; align-items: center;
        }
        .ui-stack { width: 100%; max-width: 400px; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .drop-zone {
            width: 100%; background: rgba(0,0,0,0.3); border: 2px dashed var(--border);
            border-radius: 20px; padding: 40px 20px; text-align: center; cursor: pointer; transition: 0.3s;
        }
        .drop-zone:hover { border-color: var(--accent); background: rgba(0, 255, 242, 0.03); }
        input[type="file"] { display: none; }
        .btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: 800; font-size: 1rem; cursor: pointer; transition: 0.3s; text-transform: uppercase; }
        .btn-primary { background: var(--accent); color: var(--bg-app); box-shadow: 0 0 15px var(--accent-glow); }
        .btn-primary:hover { transform: translateY(-3px); background: #fff; }
        .btn-save { background: transparent; border: 2px solid var(--accent); color: var(--accent); text-decoration: none; display: none; text-align: center; font-weight: 800; padding: 14px; border-radius: 12px; }

        .progress-wrap { width: 100%; height: 6px; background: #1a1e28; border-radius: 10px; overflow: hidden; display: none; margin-top: 10px; }
        .progress-bar { width: 0%; height: 100%; background: var(--accent); box-shadow: 0 0 10px var(--accent); transition: width 0.1s; }

        #resultArea { width: 100%; margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px; text-align: center; }
        #resultArea img { max-width: 100%; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .review-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .review-card { background: var(--bg-card); padding: 25px; border-radius: 20px; border: 1px solid var(--border); font-size: 0.95rem; }
        .review-card i { color: var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <span class="protocol-label">Nexus Protocol v5.1 // Deep Frequency Edition</span>
        <h1>Audio â‡„ Image<br><span>Universal Transformer</span></h1>
        <p style="color: var(--text-muted); margin-top: 15px;">Frequencies optimized for deep spectral texture. 100% Client-Side.</p>
    </header>

    <main class="transformer-card">
        <div class="ui-stack">
            <label class="drop-zone" id="dropZone" for="fileInput">
                <div id="fileInfo">
                    <span style="font-size: 2.5rem; display: block; margin-bottom: 10px;">ðŸ“‰</span>
                    <strong>Initialize Asset</strong><br>
                    <small style="color: var(--text-muted);">Drop PNG or WAV here</small>
                </div>
                <input type="file" id="fileInput" accept=".png,.jpg,.jpeg,.wav">
            </label>

            <button class="btn btn-primary" id="startBtn">Begin Transmutation</button>
            <div class="progress-wrap" id="progressWrap"><div class="progress-bar" id="progressBar"></div></div>
            <a href="#" id="saveBtn" class="btn-save" download>Save Transmuted Asset</a>
        </div>
        <div id="resultArea"></div>
    </main>

    <div class="review-grid">
        <div class="review-card">
            <p><i>"The new deep-frequency encoding is a game changer. The audio sounds like a dark industrial heartbeat. It's much more pleasant to audit high-res blueprints now."</i></p>
            <strong style="display: block; margin-top: 15px;">- Julian V., Senior Data Architect</strong>
        </div>
        <div class="review-card">
            <p><i>"By lowering the sample rate, we found that our data textures become much more visible in the audio spectrum. Our business 'vibe' has never been deeper."</i></p>
            <strong style="display: block; margin-top: 15px;">- Sarah M., Chief Vibe Officer</strong>
        </div>
    </div>
</div>

<canvas id="c" style="display:none;"></canvas>

<script>
    const fileInput = document.getElementById('fileInput');
    const startBtn = document.getElementById('startBtn');
    const saveBtn = document.getElementById('saveBtn');
    const resultArea = document.getElementById('resultArea');
    const bar = document.getElementById('progressBar');
    const wrap = document.getElementById('progressWrap');
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');

    // GESENKTE SAMPLERATE FÃœR TIEFERE TÃ–NE (11025 statt 44100)
    const SAMPLERATE = 11025;

    fileInput.onchange = () => {
        if(fileInput.files[0]) document.getElementById('fileInfo').innerHTML = `<strong>Locked:</strong><br>${fileInput.files[0].name}`;
    };

    startBtn.onclick = async () => {
        const file = fileInput.files[0];
        if (!file) return alert("Select a file first.");

        wrap.style.display = "block";
        bar.style.width = "20%";
        resultArea.innerHTML = "<em>Transmuting...</em>";

        if (file.name.toLowerCase().endsWith('.wav')) {
            await processAudio(file);
        } else {
            await processImage(file);
        }
        bar.style.width = "100%";
        setTimeout(() => wrap.style.display = "none", 500);
    };

    async function processImage(file) {
        const img = new Image();
        img.src = URL.createObjectURL(file);
        await img.decode();
        canvas.width = img.width; canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

        const totalSamples = 4 + (img.width * img.height * 3);
        const buffer = new ArrayBuffer(44 + totalSamples * 2);
        const view = new DataView(buffer);

        const writeStr = (pos, str) => { for (let i=0; i<str.length; i++) view.setUint8(pos+i, str.charCodeAt(i)); };
        writeStr(0, 'RIFF'); view.setUint32(4, 36 + totalSamples * 2, true); writeStr(8, 'WAVE');
        writeStr(12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true);
        view.setUint32(24, SAMPLERATE, true); view.setUint32(28, SAMPLERATE * 2, true); view.setUint16(32, 2, true); view.setUint16(34, 16, true);
        writeStr(36, 'data'); view.setUint32(40, totalSamples * 2, true);

        view.setInt16(44, (img.width / 10000 - 1) * 32767, true);
        view.setInt16(46, (img.height / 10000 - 1) * 32767, true);
        
        for (let i = 0, p = 48; i < data.length; i += 4, p += 6) {
            view.setInt16(p, (data[i] / 127.5 - 1) * 32767, true);
            view.setInt16(p+2, (data[i+1] / 127.5 - 1) * 32767, true);
            view.setInt16(p+4, (data[i+2] / 127.5 - 1) * 32767, true);
        }

        const url = URL.createObjectURL(new Blob([buffer], {type:'audio/wav'}));
        resultArea.innerHTML = `<strong>Synthesis Success</strong><br><audio controls src="${url}"></audio>`;
        saveBtn.href = url; saveBtn.style.display = "block"; saveBtn.download = "nexus_lowfreq_stream.wav";
    }

    async function processAudio(file) {
        const ab = await file.arrayBuffer();
        const view = new DataView(ab);
        
        const w = Math.round(((view.getInt16(44, true) / 32767) + 1) * 10000);
        const h = Math.round(((view.getInt16(46, true) / 32767) + 1) * 10000);

        if (w <= 0 || h <= 0 || w > 5000) return alert("Error: No Nexus Header found. Use original .wav files.");

        canvas.width = w; canvas.height = h;
        const imgData = ctx.createImageData(w, h);

        for (let i = 0, p = 48; i < w * h; i++, p += 6) {
            imgData.data[i*4]   = ((view.getInt16(p, true) / 32767) + 1) * 127.5;
            imgData.data[i*4+1] = ((view.getInt16(p+2, true) / 32767) + 1) * 127.5;
            imgData.data[i*4+2] = ((view.getInt16(p+4, true) / 32767) + 1) * 127.5;
            imgData.data[i*4+3] = 255;
        }

        ctx.putImageData(imgData, 0, 0);
        const url = canvas.toDataURL();
        resultArea.innerHTML = `<strong>Reconstruction Success (${w}x${h})</strong><br><img src="${url}">`;
        saveBtn.href = url; saveBtn.style.display = "block"; saveBtn.download = "reconstructed.png";
    }
</script>
</body>
</html>